{% load wagtailimages_tags %}

<figure class="margin-top margin-bottom">
    {% if self.image.width > self.image.height %}
        {% image self.image width-800 class="img-responsive" %}
    {% else %}
        {% image self.image height-400 class="img-responsive" %}
    {% endif %}
    
    {% if self.caption %}
        <caption>{{ self.caption }}</caption>
    {% endif %}
</figure>